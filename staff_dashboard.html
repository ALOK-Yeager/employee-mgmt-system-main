<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Employee Mgmt — Staff Dashboard (IP Logs)</title>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial;margin:2rem;background:#f6f8fb;color:#0b1220}
    .wrap{max-width:1100px;margin:0 auto}
    .card{background:#fff;border-radius:8px;padding:1rem;box-shadow:0 6px 18px rgba(20,30,60,0.06);margin-bottom:1rem}
    table{width:100%;border-collapse:collapse}
    th,td{padding:.5rem;border-bottom:1px solid #eef2f7;text-align:left;font-size:.95rem}
    th{background:#f1f5f9}
    button{padding:.45rem .65rem;border-radius:6px;border:0;background:#2563eb;color:#fff;cursor:pointer}
    .muted{color:#475569}
  </style>
</head>
<body>
  <div class="wrap">
    <h2>Staff Dashboard — Login Audit (Demo)</h2>
    <div class="card">
      <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
        <button id="loadLocal">Load local logs (demo)</button>
        <button id="fetchBackend">Fetch from backend /api/logs (optional)</button>
        <button id="exportCSV">Export shown logs (CSV)</button>
        <input id="backendLogsUrl" style="flex:1;padding:.4rem;border-radius:6px;border:1px solid #e2e8f0" value="http://localhost:5000/api/logs" />
      </div>
      <p class="muted">This dashboard reads saved logs from browser localStorage (key: <code>demo_login_logs</code>) or optionally attempts to fetch logs from your backend endpoint (GET). Use this to demonstrate the IP-tracking idea to your mentor without touching the backend.</p>
    </div>

    <div class="card" id="tableCard">
      <table id="logsTable">
        <thead><tr><th>Username</th><th>Timestamp</th><th>IP</th><th>UserAgent</th><th>Note</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

<script>
function renderTable(rows){
  const tbody = document.querySelector('#logsTable tbody');
  tbody.innerHTML = '';
  if(!rows || rows.length===0){
    tbody.innerHTML = '<tr><td colspan="5" class="muted">No logs to show. Click "Load local" after performing a demo login.</td></tr>';
    return;
  }
  rows.slice().reverse().forEach(r => {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${escapeHtml(r.username||'')}</td>
                    <td>${escapeHtml(r.timestamp||'')}</td>
                    <td>${escapeHtml(r.ip||'')}</td>
                    <td style="max-width:300px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis">${escapeHtml(r.userAgent||'')}</td>
                    <td>${escapeHtml(r.note||'')}</td>`;
    tbody.appendChild(tr);
  });
}

function escapeHtml(s){ return (s+'').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[c])); }

function loadLocal(){
  const raw = localStorage.getItem('demo_login_logs') || '[]';
  try{
    const arr = JSON.parse(raw);
    renderTable(arr);
  }catch(e){
    alert('Corrupted localStorage data');
  }
}

async function fetchBackend(){
  const url = document.getElementById('backendLogsUrl').value.trim();
  if(!url.startsWith('http')){ alert('Provide a valid backend URL'); return; }
  try{
    const resp = await fetch(url, {mode:'cors'});
    if(!resp.ok) throw new Error('Status '+resp.status);
    const json = await resp.json();
    // Expecting array of {username,timestamp,ip,userAgent,note} — adapt your backend to return this if needed.
    renderTable(json);
  }catch(e){
    alert('Could not fetch backend logs: ' + e.message);
  }
}

function exportCSV(){
  const rows = [];
  const tbody = document.querySelectorAll('#logsTable tbody tr');
  tbody.forEach(tr => {
    const cols = Array.from(tr.querySelectorAll('td')).map(td => td.innerText);
    if(cols.length) rows.push(cols);
  });
  if(rows.length===0){ alert('No rows to export'); return; }
  const headers = ['username','timestamp','ip','userAgent','note'];
  const csv = [headers.join(','), ...rows.map(r => r.map(c => `"${(c||'').replace(/"/g,'""')}"`).join(','))].join('\\n');
  const blob = new Blob([csv], {type:'text/csv'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'shown_login_logs.csv';
  document.body.appendChild(a); a.click(); a.remove();
}

document.getElementById('loadLocal').addEventListener('click', loadLocal);
document.getElementById('fetchBackend').addEventListener('click', fetchBackend);
document.getElementById('exportCSV').addEventListener('click', exportCSV);

// Auto-load local on page open for convenience
loadLocal();
</script>
</body>
</html>
